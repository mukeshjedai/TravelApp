@page

<script type="text/javascript" src="[https://code.jquery.com/jquery-3.5.1.js](https://code.jquery.com/jquery-3.5.1.js)"></script>
<script type="text/javascript" src="[https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js](https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js)"></script>
<link rel="stylesheet" href="[https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css](https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css)" />

<p>Correct answers: <span id="correctCounter">0</span></p>
<p id="startQuiz">Site visited: @ViewBag.Message</p>

<div class="text-center">
    <h1 class="display-4">Australian Citizenship Practice Test</h1>
</div>

<table id="example" class="display" style="width:100%">
    <thead>
    <tr>
        <th id="question">Question</th>
    </tr>
    </thead>
    <tbody>
    <tr></tr>
    </tbody>
</table>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var data = JSON.parse(this.responseText);
                var correctCount = 0;

                for (var i = 0; i < data.length; i++) {
                    var tr = document.createElement("tr");
                    var tdQuestion = document.createElement("th");
                    tdQuestion.textContent = data[i].question;
                    tr.appendChild(tdQuestion);

                    // Create hidden answer cell
                    var tdAnswer = document.createElement("td");
                    tdAnswer.textContent = data[i].answer;
                    tdAnswer.style.display = "none"; // Hide the answer cell
                    tr.appendChild(tdAnswer);

                    var options = [data[i].option1, data[i].option2, data[i].option3, data[i].option4];

                    for (var j = 0; j < options.length; j++) {
                        var tdOption = document.createElement("td");
                        var label = document.createElement("label");
                        var input = document.createElement("input");
                        input.type = "radio";
                        input.name = "answer_" + i;
                        input.value = options[j];

                        input.addEventListener("change", function() {
                            
                            var row = this.closest("tr");
                            var correctAnswer = row.querySelector("td:nth-child(2)").textContent -1; // Get answer from hidden cell
                            var allOptions = row.querySelectorAll("input[type=radio]");
                            //console.log(correctAnswer)
                            var selectedIndex = -1; // Initialize to -1 (not found)
                            for (var i = 0; i < allOptions.length; i++) {
                                if (allOptions[i].checked) {
                                    selectedIndex = i; // Found the selected radio button
                                    break;
                                }
                            }
                            
                            for (var k = 0; k < allOptions.length; k++) {
                                allOptions[k].disabled = true;
                                //console.log(selectedAnswer)
                                var cell = allOptions[k].closest("td");
                                cell.style.backgroundColor = selectedIndex === correctAnswer ? "#66ff66" : "#ff6666";
                            }

                            if (selectedIndex  === correctAnswer) {
                                correctCount++;
                                document.getElementById("correctCounter").textContent = correctCount;
                            }
                        });

                        label.textContent = options[j];
                        label.insertBefore(input, label.firstChild);
                        tdOption.appendChild(label);
                        tr.appendChild(tdOption);
                    }

                    document.getElementById("example").getElementsByTagName("tbody")[0].appendChild(tr);
                }
            }
        };

        xhttp.open("GET", "/api/Topics", true);
        xhttp.setRequestHeader("Content-type", "application/json");
        xhttp.send();
    });
</script>

<script>
    $('#example').DataTable({
        "language": {
            "paginate": {
                "previous": "",
                "next": "Next"
            }
        },
        paging: true,
        ordering: false,
        info: false,
        searching: false,
        lengthChange: false,
        "columnDefs": [
            { "targets": [1], "visible": false } // Hide the second column (answer)
        ]
    });
</script>

<style>
    th {
        background-color: #00638f;
        color: #fff;
        padding: 10px;
    }

    tr {
        background-color: #f2f2f2;
        color: #00638f;
        padding: 10px;
    }

    input[type=radio] {
        margin-right: 10px;
    }
</style>
